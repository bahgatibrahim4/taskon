<!-- ğŸ“ Ù…ÙƒÙˆÙ† Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø·Ø·Ø§Øª Ø§Ù„Ù‡Ù†Ø¯Ø³ÙŠØ© -->
<!-- ÙŠÙ…ÙƒÙ† Ø¯Ù…Ø¬ Ù‡Ø°Ø§ Ø§Ù„Ù…ÙƒÙˆÙ† ÙÙŠ Ø£ÙŠ ØµÙØ­Ø© Ù…Ø´Ø±ÙˆØ¹ -->

<div class="drawings-page">
    <div class="drawings-container">
        <div class="drawings-main-content">
            <!-- Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø¯ÙˆØ§Øª -->
            <div class="drawings-toolbar">
                <div class="drawings-toolbar-left">
                    <!-- Ø§Ù„Ø¨Ø­Ø« -->
                    <div class="drawings-search-container">
                        <input type="text" class="drawings-search-input" id="drawingsSearchInput" placeholder="Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ø®Ø·Ø·Ø§Øª (Ø±Ù‚Ù…ØŒ Ø§Ø³Ù…ØŒ Ù†Ù…ÙˆØ°Ø¬...)">
                        <span class="drawings-search-icon">ğŸ”</span>
                    </div>
                    
                    <!-- Ø§Ù„ÙÙ„Ø§ØªØ± -->
                    <select class="drawings-filter-select" id="drawingsTypeFilter">
                        <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</option>
                        <option value="Ø§Ù†Ø´Ø§Ø¦ÙŠ">ğŸ—ï¸ Ø§Ù†Ø´Ø§Ø¦ÙŠ</option>
                        <option value="Ù…Ø¹Ù…Ø§Ø±ÙŠ">ğŸ›ï¸ Ù…Ø¹Ù…Ø§Ø±ÙŠ</option>
                        <option value="Ù…ÙŠÙƒØ§Ù†ÙŠÙƒØ§">âš™ï¸ Ù…ÙŠÙƒØ§Ù†ÙŠÙƒØ§</option>
                        <option value="ÙƒÙ‡Ø±Ø¨Ø§Ø¡">âš¡ ÙƒÙ‡Ø±Ø¨Ø§Ø¡</option>
                        <option value="Ù…Ø³Ø§Ø­Ø©">ğŸ“ Ù…Ø³Ø§Ø­Ø©</option>
                        <option value="Ù…ÙˆÙ‚Ø¹ Ø¹Ø§Ù…">ğŸ—ºï¸ Ù…ÙˆÙ‚Ø¹ Ø¹Ø§Ù…</option>
                    </select>
                    
                    <select class="drawings-filter-select" id="drawingsModelFilter">
                        <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬</option>
                    </select>
                    
                    <select class="drawings-filter-select" id="drawingsItemFilter">
                        <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨Ù†ÙˆØ¯</option>
                    </select>
                </div>
                
                <div class="drawings-toolbar-right">
                    <!-- ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø¹Ø±Ø¶ -->
                    <div class="drawings-view-toggle">
                        <button class="drawings-view-btn active" id="drawingsTableViewBtn" title="Ø¹Ø±Ø¶ Ø¬Ø¯ÙˆÙ„">
                            <span>ğŸ“‹</span>
                            Ø¬Ø¯ÙˆÙ„
                        </button>
                        <button class="drawings-view-btn" id="drawingsGridViewBtn" title="Ø¹Ø±Ø¶ ÙƒØ§Ø±Ø¯Ø§Øª">
                            <span>ğŸ”²</span>
                            ÙƒØ§Ø±Ø¯Ø§Øª
                        </button>
                    </div>
                    
                    <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª -->
                    <button class="drawings-btn drawings-btn-primary" id="drawingsAddBtn">
                        <span>â•</span>
                        Ø¥Ø¶Ø§ÙØ© Ù…Ø®Ø·Ø·
                    </button>
                    
                    <button class="drawings-btn drawings-btn-secondary" id="drawingsExportBtn">
                        <span>ğŸ“¤</span>
                        ØªØµØ¯ÙŠØ±
                    </button>
                    
                    <button class="drawings-btn drawings-btn-secondary" id="drawingsImportBtn">
                        <span>ğŸ“¥</span>
                        Ø§Ø³ØªÙŠØ±Ø§Ø¯
                    </button>
                </div>
            </div>

            <!-- ØªØ®Ø·ÙŠØ· Ø§Ù„Ù…Ø­ØªÙˆÙ‰ -->
            <div class="drawings-content-layout">
                <!-- Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ -->
                <div class="drawings-sidebar">
                    <div class="drawings-section-title-container">
                        <div class="drawings-section-title-box">
                            <h2>Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù…Ø®Ø·Ø·Ø§Øª</h2>
                        </div>
                    </div>
                    
                    <div id="drawingsFoldersList">
                        <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¡ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
                    </div>
                </div>

                <!-- Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
                <div class="drawings-main-area">
                    <!-- Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù‚Ø³Ù… -->
                    <div class="drawings-section-title-container">
                        <div class="drawings-section-title-box">
                            <h2 id="drawingsSectionTitle">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø®Ø·Ø·Ø§Øª</h2>
                        </div>
                    </div>
                    
                    <!-- Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø®Ø·Ø·Ø§Øª -->
                    <div style="margin-bottom: 15px; font-size: 12px; color: #666;">
                        <span id="drawingsTotalCount">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: 0</span>
                    </div>

                    <!-- Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ø¯ÙˆÙ„ -->
                    <div class="drawings-table-container" id="drawingsTableView">
                        <table class="drawings-table">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Ø±Ù‚Ù… Ø§Ù„Ù…Ø®Ø·Ø·</th>
                                    <th>Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…Ø¨Ù†Ù‰</th>
                                    <th>Ø§Ø³Ù… Ø§Ù„Ù…Ø®Ø·Ø·</th>
                                    <th>Ø§Ù„Ù‚Ø³Ù…</th>
                                    <th>Ø§Ù„Ø¨Ù†Ø¯</th>
                                    <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                    <th>Ø§Ù„Ù…Ù„ÙØ§Øª</th>
                                    <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                </tr>
                            </thead>
                            <tbody id="drawingsTableBody">
                                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
                            </tbody>
                        </table>
                    </div>

                    <!-- Ø¹Ø±Ø¶ Ø§Ù„Ø´Ø¨ÙƒØ© -->
                    <div class="drawings-grid" id="drawingsGridView" style="display: none;">
                        <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¡ Ø§Ù„ÙƒØ§Ø±Ø¯Ø§Øª Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
                    </div>

                    <!-- Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„ÙØ§Ø±ØºØ© -->
                    <div class="drawings-empty-state" id="drawingsEmptyState" style="display: none;">
                        <div class="drawings-empty-state-icon">ğŸ“</div>
                        <div class="drawings-empty-state-text">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø®Ø·Ø·Ø§Øª Ù‡Ù†Ø¯Ø³ÙŠØ©</div>
                        <p style="margin-top: 1rem; opacity: 0.7;">Ø§Ø¨Ø¯Ø£ Ø¨Ø¥Ø¶Ø§ÙØ© Ù…Ø®Ø·Ø· Ø¬Ø¯ÙŠØ¯ Ù…Ù† Ø®Ù„Ø§Ù„ Ø§Ù„Ø²Ø± Ø£Ø¹Ù„Ø§Ù‡</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© Ù„Ø¥Ø¶Ø§ÙØ©/ØªØ¹Ø¯ÙŠÙ„ Ù…Ø®Ø·Ø· -->
<div class="drawings-modal" id="drawingsModal">
    <div class="drawings-modal-content">
        <h3 id="drawingsModalTitle">ğŸ“‹ Ø¥Ø¶Ø§ÙØ© Ù…Ø®Ø·Ø· Ø¬Ø¯ÙŠØ¯</h3>
        <form id="drawingsForm">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div class="drawings-form-group">
                    <label class="drawings-form-label">Ø±Ù‚Ù… Ø§Ù„Ù…Ø®Ø·Ø·</label>
                    <input type="text" class="drawings-form-input" id="drawingNumber" name="drawingNumber" required>
                </div>
                
                <div class="drawings-form-group">
                    <label class="drawings-form-label">Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…Ø¨Ù†Ù‰</label>
                    <input type="text" class="drawings-form-input" id="buildingModel" name="buildingModel" required>
                </div>
            </div>
            
            <div class="drawings-form-group">
                <label class="drawings-form-label">Ø§Ø³Ù… Ø§Ù„Ù…Ø®Ø·Ø·</label>
                <input type="text" class="drawings-form-input" id="drawingName" name="drawingName" required>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div class="drawings-form-group">
                    <label class="drawings-form-label">Ø§Ù„Ù‚Ø³Ù…</label>
                    <select class="drawings-form-select" id="drawingType" name="drawingType" required>
                        <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù… --</option>
                        <option value="Ø§Ù†Ø´Ø§Ø¦ÙŠ">ğŸ—ï¸ Ø§Ù†Ø´Ø§Ø¦ÙŠ</option>
                        <option value="Ù…Ø¹Ù…Ø§Ø±ÙŠ">ğŸ›ï¸ Ù…Ø¹Ù…Ø§Ø±ÙŠ</option>
                        <option value="Ù…ÙŠÙƒØ§Ù†ÙŠÙƒØ§">âš™ï¸ Ù…ÙŠÙƒØ§Ù†ÙŠÙƒØ§</option>
                        <option value="ÙƒÙ‡Ø±Ø¨Ø§Ø¡">âš¡ ÙƒÙ‡Ø±Ø¨Ø§Ø¡</option>
                        <option value="Ù…Ø³Ø§Ø­Ø©">ğŸ“ Ù…Ø³Ø§Ø­Ø©</option>
                        <option value="Ù…ÙˆÙ‚Ø¹ Ø¹Ø§Ù…">ğŸ—ºï¸ Ù…ÙˆÙ‚Ø¹ Ø¹Ø§Ù…</option>
                    </select>
                </div>
                
                <div class="drawings-form-group">
                    <label class="drawings-form-label">Ø§Ù„Ø¨Ù†Ø¯</label>
                    <input type="text" class="drawings-form-input" id="drawingFolder" name="drawingFolder" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ø¯">
                </div>
            </div>
            
            <div class="drawings-form-group">
                <label class="drawings-form-label">Ø§Ù„Ø¨ÙŠØ§Ù†</label>
                <textarea class="drawings-form-input" id="drawingStatement" name="drawingStatement" rows="3" placeholder="Ø¨ÙŠØ§Ù† Ø§Ù„Ù…Ø®Ø·Ø· ÙˆØªÙØ§ØµÙŠÙ„Ù‡"></textarea>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div class="drawings-form-group">
                    <label class="drawings-form-label">Ù…Ù„Ù DWG</label>
                    <input type="file" class="drawings-form-input" id="dwgFile" name="dwgFile" accept=".dwg">
                    <div id="dwgFileInfo" style="display: none; margin-top: 5px; font-size: 11px; color: #666;"></div>
                </div>
                
                <div class="drawings-form-group">
                    <label class="drawings-form-label">Ù…Ù„Ù PDF</label>
                    <input type="file" class="drawings-form-input" id="pdfFile" name="pdfFile" accept=".pdf">
                    <div id="pdfFileInfo" style="display: none; margin-top: 5px; font-size: 11px; color: #666;"></div>
                </div>
            </div>
            
            <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 30px;">
                <button type="button" class="drawings-btn drawings-btn-secondary" onclick="closeDrawingsModal()">Ø¥Ù„ØºØ§Ø¡</button>
                <button type="submit" class="drawings-btn drawings-btn-primary">
                    <span>ğŸ’¾</span>
                    Ø­ÙØ¸ Ø§Ù„Ù…Ø®Ø·Ø·
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Ø¥Ø¯Ø®Ø§Ù„ Ù…Ù„Ù CSV Ù…Ø®ÙÙŠ -->
<input type="file" id="drawingsImportFile" accept=".csv" style="display: none;">

<script>
// ğŸš€ Ø³ÙƒØ±ÙŠØ¨Øª Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø·Ø·Ø§Øª Ø§Ù„Ù‡Ù†Ø¯Ø³ÙŠØ©
(function() {
    'use strict';
    
    // ===============================
    // ğŸ”§ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆØ§Ù„Ù…ØªØºÙŠØ±Ø§Øª
    // ===============================
    
    // Ø¶Ø¨Ø· API_URL Ø­Ø³Ø¨ Ø§Ù„Ø¨ÙŠØ¦Ø©
    const API_URL = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1' 
        ? 'https://taskon-production.up.railway.app' 
        : 'https://taskon-production.up.railway.app';
    
    // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…Ø¹Ø±ÙØ§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ ÙˆØ§Ù„Ø´Ø±ÙƒØ©
    const urlParams = new URLSearchParams(window.location.search);
    const projectId = urlParams.get('projectId') || localStorage.getItem('currentProjectId') || "68f89815d8013418f5ab28d9";
    const companyId = urlParams.get('companyId') || localStorage.getItem('currentCompanyId') || "68f86f97a05ae9ba3e2f1dde";
    
    // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    let drawings = [];
    let currentEditingId = null;
    let currentView = "table"; // 'table' or 'grid'
    let currentSearchTerm = "";
    let currentTypeFilter = "";
    let currentModelFilter = "";
    let currentItemFilter = "";
    let hierarchicalMode = false;
    let currentDepartment = null;
    let currentModel = null;
    let currentItem = null;
    
    // Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø«Ø§Ø¨ØªØ©
    const departments = [
        { id: "structural", name: "Ø§Ù†Ø´Ø§Ø¦ÙŠ", icon: "ğŸ—ï¸" },
        { id: "architectural", name: "Ù…Ø¹Ù…Ø§Ø±ÙŠ", icon: "ğŸ›ï¸" },
        { id: "mechanical", name: "Ù…ÙŠÙƒØ§Ù†ÙŠÙƒØ§", icon: "âš™ï¸" },
        { id: "electrical", name: "ÙƒÙ‡Ø±Ø¨Ø§Ø¡", icon: "âš¡" },
        { id: "surveying", name: "Ù…Ø³Ø§Ø­Ø©", icon: "ğŸ“" },
        { id: "general", name: "Ù…ÙˆÙ‚Ø¹ Ø¹Ø§Ù…", icon: "ğŸ—ºï¸" }
    ];
    
    // ===============================
    // ğŸŒ Ø¯ÙˆØ§Ù„ API
    // ===============================
    
    async function apiCall(endpoint, method = "GET", data = null) {
        const url = `${API_URL}${endpoint}?projectId=${projectId}&companyId=${companyId}`;
        console.log("ğŸŒ API Call:", method, url);
        
        const options = {
            method,
            headers: { "Content-Type": "application/json" }
        };
        if (data && method !== "GET") {
            options.body = JSON.stringify(data);
        }
        
        try {
            const response = await fetch(url, options);
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            const result = await response.json();
            return result;
        } catch (error) {
            console.error("âŒ API Call Error:", error);
            throw error;
        }
    }
    
    // ===============================
    // ğŸ“Š ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    // ===============================
    
    async function loadDrawings() {
        try {
            console.log("ğŸ”„ Loading drawings from API...");
            const response = await apiCall("/drawings");
            drawings = Array.isArray(response) ? response : (response.data || []);
            console.log("ğŸ“‹ Drawings loaded:", drawings.length);
            
            updateFilterOptions();
            renderDrawings();
        } catch (error) {
            console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø®Ø·Ø·Ø§Øª:", error);
            drawings = [];
            renderDrawings();
        }
    }
    
    // ===============================
    // ğŸ¨ Ø¯ÙˆØ§Ù„ Ø§Ù„Ø¹Ø±Ø¶
    // ===============================
    
    function renderFolders() {
        const list = document.getElementById("drawingsFoldersList");
        
        if (!hierarchicalMode) {
            // Ø¹Ø±Ø¶ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
            list.innerHTML = `
                <div class="drawings-folder-item" onclick="selectAllFolders()">
                    <span>ğŸ“‹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø®Ø·Ø·Ø§Øª</span>
                    <div class="drawings-folder-stats">${drawings.length}</div>
                </div>
            ` + departments.map(dept => {
                const count = drawings.filter(d => d.type === dept.name).length;
                return `
                    <div class="drawings-folder-item" onclick="selectDepartment('${dept.name}')">
                        <span>${dept.icon} ${dept.name}</span>
                        <div class="drawings-folder-stats">${count}</div>
                    </div>
                `;
            }).join("");
        } else {
            // Ø¹Ø±Ø¶ Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ù‡Ø±Ù…ÙŠ
            let backButton = `
                <div class="drawings-folder-item back-button" onclick="goBackToDepartments()">
                    <span>â† Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø£Ù‚Ø³Ø§Ù…</span>
                </div>
            `;
            
            if (currentDepartment && !currentModel) {
                // Ø¹Ø±Ø¶ Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ
                const deptDrawings = drawings.filter(d => d.type === currentDepartment);
                const models = [...new Set(deptDrawings.map(d => d.buildingModel).filter(Boolean))];
                
                list.innerHTML = backButton + models.map(model => {
                    const count = deptDrawings.filter(d => d.buildingModel === model).length;
                    return `
                        <div class="drawings-folder-item" onclick="selectModel('${model}')">
                            <span>ğŸ¢ ${model}</span>
                            <div class="drawings-folder-stats">${count}</div>
                        </div>
                    `;
                }).join("");
            } else if (currentDepartment && currentModel) {
                // Ø¹Ø±Ø¶ Ø§Ù„Ø¨Ù†ÙˆØ¯
                const modelDrawings = drawings.filter(d => 
                    d.type === currentDepartment && d.buildingModel === currentModel
                );
                const items = [...new Set(modelDrawings.map(d => d.itemName).filter(Boolean))];
                
                list.innerHTML = `
                    <div class="drawings-folder-item back-button" onclick="goBackToModels()">
                        <span>â† Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù†Ù…Ø§Ø°Ø¬</span>
                    </div>
                ` + items.map(item => {
                    const count = modelDrawings.filter(d => d.itemName === item).length;
                    return `
                        <div class="drawings-folder-item" onclick="selectItem('${item}')">
                            <span>ğŸ“ ${item}</span>
                            <div class="drawings-folder-stats">${count}</div>
                        </div>
                    `;
                }).join("");
            }
        }
    }
    
    function renderDrawings() {
        const tableBody = document.getElementById("drawingsTableBody");
        const gridView = document.getElementById("drawingsGridView");
        const emptyState = document.getElementById("drawingsEmptyState");
        const totalCount = document.getElementById("drawingsTotalCount");
        
        // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„Ø§ØªØ±
        const filteredDrawings = getFilteredDrawings();
        
        totalCount.textContent = `Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: ${filteredDrawings.length}`;
        
        if (filteredDrawings.length === 0) {
            if (currentView === 'table') {
                tableBody.innerHTML = "";
            } else {
                gridView.innerHTML = "";
            }
            emptyState.style.display = "block";
            return;
        }
        
        emptyState.style.display = "none";
        
        if (currentView === 'table') {
            renderTableView(filteredDrawings);
        } else {
            renderGridView(filteredDrawings);
        }
    }
    
    function renderTableView(drawingsToRender) {
        const tableBody = document.getElementById("drawingsTableBody");
        
        tableBody.innerHTML = drawingsToRender.map((drawing, index) => {
            return `
                <tr>
                    <td>${index + 1}</td>
                    <td><strong class="drawings-number">${drawing.drawingNumber || '-'}</strong></td>
                    <td>${drawing.buildingModel || '-'}</td>
                    <td>${drawing.name || '-'}</td>
                    <td>${drawing.type || '-'}</td>
                    <td>${drawing.itemName || '-'}</td>
                    <td>${drawing.lastModified ? new Date(drawing.lastModified).toLocaleDateString('ar-EG') : '-'}</td>
                    <td>
                        ${drawing.dwgFile ? 
                            `<a href="${drawing.dwgFile}" target="_blank" style="color: var(--primary-color); margin-left: 5px;">DWG</a>` : 
                            ''
                        }
                        ${drawing.pdfFile ? 
                            `<a href="${drawing.pdfFile}" target="_blank" style="color: var(--danger);">PDF</a>` : 
                            ''
                        }
                        ${!drawing.dwgFile && !drawing.pdfFile ? '-' : ''}
                    </td>
                    <td>
                        <button class="drawings-action-btn drawings-action-edit" onclick="editDrawing('${drawing._id}')" title="ØªØ¹Ø¯ÙŠÙ„">
                            âœï¸
                        </button>
                        <button class="drawings-action-btn drawings-action-delete" onclick="deleteDrawing('${drawing._id}')" title="Ø­Ø°Ù">
                            ğŸ—‘ï¸
                        </button>
                    </td>
                </tr>
            `;
        }).join("");
    }
    
    function renderGridView(drawingsToRender) {
        const gridView = document.getElementById("drawingsGridView");
        
        gridView.innerHTML = drawingsToRender.map((drawing) => {
            return `
                <div class="drawings-card">
                    <div class="drawings-card-header">
                        <div class="drawings-card-title">${drawing.name || 'Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…'}</div>
                        <div class="drawings-card-number">${drawing.drawingNumber || '-'}</div>
                    </div>
                    
                    <div class="drawings-card-meta">
                        ${drawing.type ? `<span class="drawings-meta-badge drawings-meta-type">${drawing.type}</span>` : ''}
                        ${drawing.buildingModel ? `<span class="drawings-meta-badge drawings-meta-model">${drawing.buildingModel}</span>` : ''}
                        ${drawing.itemName ? `<span class="drawings-meta-badge drawings-meta-folder">${drawing.itemName}</span>` : ''}
                    </div>
                    
                    ${drawing.statement ? `<p style="font-size: 12px; color: #666; margin-bottom: 15px;">${drawing.statement}</p>` : ''}
                    
                    <div class="drawings-card-files">
                        ${drawing.dwgFile ? 
                            `<a href="${drawing.dwgFile}" target="_blank" class="drawings-file-badge drawings-file-dwg">ğŸ“„ DWG</a>` : 
                            `<div class="drawings-file-badge drawings-file-dwg" style="opacity: 0.3;">ğŸ“„ DWG</div>`
                        }
                        ${drawing.pdfFile ? 
                            `<a href="${drawing.pdfFile}" target="_blank" class="drawings-file-badge drawings-file-pdf">ğŸ“„ PDF</a>` : 
                            `<div class="drawings-file-badge drawings-file-pdf" style="opacity: 0.3;">ğŸ“„ PDF</div>`
                        }
                    </div>
                    
                    <div class="drawings-card-actions">
                        <button class="drawings-action-btn drawings-action-edit" onclick="editDrawing('${drawing._id}')" title="ØªØ¹Ø¯ÙŠÙ„">
                            âœï¸
                        </button>
                        <button class="drawings-action-btn drawings-action-delete" onclick="deleteDrawing('${drawing._id}')" title="Ø­Ø°Ù">
                            ğŸ—‘ï¸
                        </button>
                    </div>
                </div>
            `;
        }).join("");
    }
    
    // ===============================
    // ğŸ” Ø¯ÙˆØ§Ù„ Ø§Ù„ÙÙ„ØªØ±Ø© ÙˆØ§Ù„Ø¨Ø­Ø«
    // ===============================
    
    function getFilteredDrawings() {
        return drawings.filter(drawing => {
            // Ø§Ù„ØªØµÙÙŠØ© Ø§Ù„Ù‡Ø±Ù…ÙŠØ©
            if (hierarchicalMode) {
                if (currentDepartment && drawing.type !== currentDepartment) return false;
                if (currentModel && drawing.buildingModel !== currentModel) return false;
                if (currentItem && drawing.itemName !== currentItem) return false;
            }
            
            // Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù†ØµÙŠ
            if (currentSearchTerm) {
                const searchTerm = currentSearchTerm.toLowerCase();
                const matchesSearch = 
                    (drawing.name && drawing.name.toLowerCase().includes(searchTerm)) ||
                    (drawing.drawingNumber && drawing.drawingNumber.toLowerCase().includes(searchTerm)) ||
                    (drawing.buildingModel && drawing.buildingModel.toLowerCase().includes(searchTerm)) ||
                    (drawing.type && drawing.type.toLowerCase().includes(searchTerm)) ||
                    (drawing.itemName && drawing.itemName.toLowerCase().includes(searchTerm));
                if (!matchesSearch) return false;
            }
            
            // Ø§Ù„ÙÙ„Ø§ØªØ± Ø§Ù„Ø¹Ø§Ø¯ÙŠØ©
            if (!hierarchicalMode && currentTypeFilter && drawing.type !== currentTypeFilter) return false;
            if (!hierarchicalMode && currentModelFilter && drawing.buildingModel !== currentModelFilter) return false;
            if (!hierarchicalMode && currentItemFilter && drawing.itemName !== currentItemFilter) return false;
            
            return true;
        });
    }
    
    function updateFilterOptions() {
        // ØªØ­Ø¯ÙŠØ« ÙÙ„ØªØ± Ø§Ù„Ù†Ù…Ø§Ø°Ø¬
        const modelFilter = document.getElementById("drawingsModelFilter");
        const uniqueModels = [...new Set(drawings.map(d => d.buildingModel).filter(Boolean))];
        modelFilter.innerHTML = '<option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬</option>' +
            uniqueModels.map(model => `<option value="${model}">${model}</option>`).join('');
        
        // ØªØ­Ø¯ÙŠØ« ÙÙ„ØªØ± Ø§Ù„Ø¨Ù†ÙˆØ¯
        const itemFilter = document.getElementById("drawingsItemFilter");
        const uniqueItems = [...new Set(drawings.map(d => d.itemName).filter(Boolean))];
        itemFilter.innerHTML = '<option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨Ù†ÙˆØ¯</option>' +
            uniqueItems.map(item => `<option value="${item}">${item}</option>`).join('');
    }
    
    // ===============================
    // ğŸ¯ Ø¯ÙˆØ§Ù„ Ø§Ù„ØªÙ†Ù‚Ù„
    // ===============================
    
    window.selectAllFolders = function() {
        hierarchicalMode = false;
        currentDepartment = null;
        currentModel = null;
        currentItem = null;
        currentTypeFilter = "";
        currentModelFilter = "";
        currentItemFilter = "";
        
        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙÙ„Ø§ØªØ± ÙÙŠ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
        document.getElementById("drawingsTypeFilter").value = "";
        document.getElementById("drawingsModelFilter").value = "";
        document.getElementById("drawingsItemFilter").value = "";
        
        updateSectionTitle();
        renderFolders();
        renderDrawings();
    };
    
    window.selectDepartment = function(departmentName) {
        hierarchicalMode = true;
        currentDepartment = departmentName;
        currentModel = null;
        currentItem = null;
        currentTypeFilter = departmentName;
        
        document.getElementById("drawingsTypeFilter").value = departmentName;
        
        updateSectionTitle();
        renderFolders();
        renderDrawings();
    };
    
    window.selectModel = function(modelName) {
        currentModel = modelName;
        currentItem = null;
        currentModelFilter = modelName;
        
        updateSectionTitle();
        renderFolders();
        renderDrawings();
    };
    
    window.selectItem = function(itemName) {
        currentItem = itemName;
        currentItemFilter = itemName;
        
        updateSectionTitle();
        renderFolders();
        renderDrawings();
    };
    
    window.goBackToDepartments = function() {
        hierarchicalMode = false;
        currentDepartment = null;
        currentModel = null;
        currentItem = null;
        currentTypeFilter = "";
        currentModelFilter = "";
        currentItemFilter = "";
        
        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙÙ„Ø§ØªØ±
        document.getElementById("drawingsTypeFilter").value = "";
        document.getElementById("drawingsModelFilter").value = "";
        document.getElementById("drawingsItemFilter").value = "";
        
        updateSectionTitle();
        renderFolders();
        renderDrawings();
    };
    
    window.goBackToModels = function() {
        currentModel = null;
        currentItem = null;
        currentModelFilter = "";
        currentItemFilter = "";
        
        updateSectionTitle();
        renderFolders();
        renderDrawings();
    };
    
    function updateSectionTitle() {
        const sectionTitle = document.getElementById("drawingsSectionTitle");
        if (hierarchicalMode) {
            let title = "";
            if (currentDepartment && currentModel && currentItem) {
                title = `${currentDepartment} > ${currentModel} > ${currentItem}`;
            } else if (currentDepartment && currentModel) {
                title = `${currentDepartment} > ${currentModel}`;
            } else if (currentDepartment) {
                title = currentDepartment;
            } else {
                title = "Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø®Ø·Ø·Ø§Øª";
            }
            sectionTitle.textContent = title;
        } else {
            sectionTitle.textContent = "Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø®Ø·Ø·Ø§Øª";
        }
    }
    
    // ===============================
    // âœï¸ Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ÙˆØ§Ù„Ø­Ø°Ù
    // ===============================
    
    window.editDrawing = function(drawingId) {
        const drawing = drawings.find(d => d._id === drawingId);
        if (!drawing) {
            alert('Ø§Ù„Ù…Ø®Ø·Ø· ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯!');
            return;
        }
        
        // Ù…Ù„Ø¡ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
        document.getElementById('drawingNumber').value = drawing.drawingNumber || '';
        document.getElementById('buildingModel').value = drawing.buildingModel || '';
        document.getElementById('drawingName').value = drawing.name || '';
        document.getElementById('drawingType').value = drawing.type || '';
        document.getElementById('drawingFolder').value = drawing.itemName || '';
        document.getElementById('drawingStatement').value = drawing.statement || '';
        
        // ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…Ø¹Ø±Ù Ù„Ù„ØªØ¹Ø¯ÙŠÙ„
        currentEditingId = drawingId;
        
        // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
        document.getElementById('drawingsModalTitle').textContent = 'âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø®Ø·Ø·';
        document.getElementById('drawingsModal').classList.add('show');
        
        // Ø§Ù„ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ø­Ù‚Ù„ Ø§Ù„Ø§Ø³Ù…
        document.getElementById('drawingName').focus();
    };
    
    window.deleteDrawing = async function(drawingId) {
        if (!confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ø®Ø·Ø·ØŸ\nÙ„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡.")) return;
        
        try {
            console.log(`ğŸ—‘ï¸ Ù…Ø­Ø§ÙˆÙ„Ø© Ø­Ø°Ù Ø§Ù„Ù…Ø®Ø·Ø·: ${drawingId}`);
            const response = await apiCall(`/drawings/${drawingId}`, "DELETE");
            
            if (response.error) {
                throw new Error(response.error);
            }
            
            await loadDrawings();
            renderFolders();
            alert("âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø®Ø·Ø·!");
        } catch (error) {
            console.error("Error deleting drawing:", error);
            alert("âŒ Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ù…Ø®Ø·Ø·: " + (error.message || "Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ"));
        }
    };
    
    // ===============================
    // ğŸ’¾ Ø¯ÙˆØ§Ù„ Ø§Ù„Ø­ÙØ¸ ÙˆØ§Ù„ØªØµØ¯ÙŠØ±
    // ===============================
    
    function generateDrawingNumber(type) {
        if (!drawings.length) return `${getDepartmentPrefix(type)}-001`;
        
        const departmentDrawings = drawings.filter(d => d.type === type);
        const existingNumbers = departmentDrawings
            .map(d => d.drawingNumber)
            .filter(num => num && num.startsWith(getDepartmentPrefix(type)))
            .map(num => {
                const match = num.match(/(\d+)$/);
                return match ? parseInt(match[0]) : 0;
            })
            .sort((a, b) => b - a);
        
        const nextNumber = existingNumbers.length > 0 ? existingNumbers[0] + 1 : 1;
        return `${getDepartmentPrefix(type)}-${nextNumber.toString().padStart(3, '0')}`;
    }
    
    function getDepartmentPrefix(type) {
        const prefixes = {
            'Ø§Ù†Ø´Ø§Ø¦ÙŠ': 'STR',
            'Ù…Ø¹Ù…Ø§Ø±ÙŠ': 'ARC', 
            'Ù…ÙŠÙƒØ§Ù†ÙŠÙƒØ§': 'MEC',
            'ÙƒÙ‡Ø±Ø¨Ø§Ø¡': 'ELE',
            'Ù…Ø³Ø§Ø­Ø©': 'SUR',
            'Ù…ÙˆÙ‚Ø¹ Ø¹Ø§Ù…': 'GEN'
        };
        return prefixes[type] || 'DRW';
    }
    
    // ===============================
    // ğŸ­ Ø¯ÙˆØ§Ù„ Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©
    // ===============================
    
    function openDrawingsModal() {
        currentEditingId = null;
        document.getElementById('drawingsModalTitle').textContent = 'ğŸ“‹ Ø¥Ø¶Ø§ÙØ© Ù…Ø®Ø·Ø· Ø¬Ø¯ÙŠØ¯';
        document.getElementById("drawingsForm").reset();
        document.getElementById('drawingsModal').classList.add('show');
    }
    
    window.closeDrawingsModal = function() {
        document.getElementById('drawingsModal').classList.remove('show');
        currentEditingId = null;
        
        // ØªÙ†Ø¸ÙŠÙ Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª
        const dwgFileInfo = document.getElementById('dwgFileInfo');
        const pdfFileInfo = document.getElementById('pdfFileInfo');
        if (dwgFileInfo) dwgFileInfo.style.display = 'none';
        if (pdfFileInfo) pdfFileInfo.style.display = 'none';
    };
    
    // ===============================
    // ğŸ“¤ Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØµØ¯ÙŠØ± ÙˆØ§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯
    // ===============================
    
    function exportDrawingsToCSV() {
        const filteredDrawings = getFilteredDrawings();
        
        if (filteredDrawings.length === 0) {
            alert("âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø®Ø·Ø·Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ±");
            return;
        }

        const csvHeaders = ['Ø±Ù‚Ù… Ø§Ù„Ù…Ø®Ø·Ø·', 'Ø§Ø³Ù… Ø§Ù„Ù…Ø®Ø·Ø·', 'Ø§Ù„Ù‚Ø³Ù…', 'Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…Ø¨Ù†Ù‰', 'Ø§Ù„Ø¨Ù†Ø¯', 'Ø§Ù„Ø¨ÙŠØ§Ù†', 'ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡'];
        const csvRows = filteredDrawings.map(drawing => [
            drawing.drawingNumber || '',
            drawing.name || '',
            drawing.type || '',
            drawing.buildingModel || '',
            drawing.itemName || '',
            drawing.statement || '',
            drawing.lastModified ? new Date(drawing.lastModified).toLocaleDateString('ar-EG') : ''
        ]);

        const csvContent = [csvHeaders, ...csvRows]
            .map(row => row.map(field => `"${field}"`).join(','))
            .join('\n');

        const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = `Ù…Ø®Ø·Ø·Ø§Øª_${new Date().toISOString().split('T')[0]}.csv`;
        link.click();
        
        alert(`âœ… ØªÙ… ØªØµØ¯ÙŠØ± ${filteredDrawings.length} Ù…Ø®Ø·Ø· Ø¨Ù†Ø¬Ø§Ø­`);
    }
    
    // ===============================
    // ğŸ® Ù…ÙØ³ØªÙ…Ø¹Ø§Øª Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
    // ===============================
    
    function setupEventListeners() {
        // Ø§Ù„Ø¨Ø­Ø«
        document.getElementById("drawingsSearchInput").addEventListener("input", (e) => {
            currentSearchTerm = e.target.value.toLowerCase();
            renderDrawings();
        });
        
        // Ø§Ù„ÙÙ„Ø§ØªØ±
        document.getElementById("drawingsTypeFilter").addEventListener("change", (e) => {
            currentTypeFilter = e.target.value;
            hierarchicalMode = false; // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù‡Ø±Ù…ÙŠ Ø¹Ù†Ø¯ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ÙÙ„Ø§ØªØ±
            renderFolders();
            renderDrawings();
        });
        
        document.getElementById("drawingsModelFilter").addEventListener("change", (e) => {
            currentModelFilter = e.target.value;
            renderDrawings();
        });
        
        document.getElementById("drawingsItemFilter").addEventListener("change", (e) => {
            currentItemFilter = e.target.value;
            renderDrawings();
        });
        
        // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø¹Ø±Ø¶
        document.getElementById("drawingsTableViewBtn").addEventListener("click", () => {
            currentView = 'table';
            document.getElementById("drawingsTableViewBtn").classList.add("active");
            document.getElementById("drawingsGridViewBtn").classList.remove("active");
            document.getElementById("drawingsTableView").style.display = 'block';
            document.getElementById("drawingsGridView").style.display = 'none';
            renderDrawings();
        });
        
        document.getElementById("drawingsGridViewBtn").addEventListener("click", () => {
            currentView = 'grid';
            document.getElementById("drawingsGridViewBtn").classList.add("active");
            document.getElementById("drawingsTableViewBtn").classList.remove("active");
            document.getElementById("drawingsTableView").style.display = 'none';
            document.getElementById("drawingsGridView").style.display = 'grid';
            renderDrawings();
        });
        
        // Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª
        document.getElementById("drawingsAddBtn").addEventListener("click", openDrawingsModal);
        document.getElementById("drawingsExportBtn").addEventListener("click", exportDrawingsToCSV);
        document.getElementById("drawingsImportBtn").addEventListener("click", () => {
            document.getElementById("drawingsImportFile").click();
        });
        
        // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø®Ø§Ø±Ø¬Ù‡Ø§
        document.getElementById('drawingsModal').addEventListener('click', (e) => {
            if (e.target === document.getElementById('drawingsModal')) {
                closeDrawingsModal();
            }
        });
        
        // ØªÙˆÙ„ÙŠØ¯ Ø±Ù‚Ù… ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„Ù‚Ø³Ù…
        document.getElementById("drawingType").addEventListener("change", (e) => {
            const selectedType = e.target.value;
            if (selectedType && !currentEditingId) {
                const generatedNumber = generateDrawingNumber(selectedType);
                document.getElementById("drawingNumber").value = generatedNumber;
            }
        });
        
        // Ù…Ø¹Ø§Ù„Ø¬Ø© ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ù„ÙØ§Øª
        document.getElementById('dwgFile').addEventListener('change', function() {
            handleFileSelect(this, 'dwgFileInfo', 'Ù…Ù„Ù DWG');
        });
        
        document.getElementById('pdfFile').addEventListener('change', function() {
            handleFileSelect(this, 'pdfFileInfo', 'Ù…Ù„Ù PDF');
        });
        
        // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
        document.getElementById("drawingsForm").addEventListener("submit", async (e) => {
            e.preventDefault();
            await saveDrawing();
        });
    }
    
    // ===============================
    // ğŸ“ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ù„ÙØ§Øª
    // ===============================
    
    function handleFileSelect(fileInput, infoElementId, fileType) {
        const file = fileInput.files[0];
        const infoElement = document.getElementById(infoElementId);
        
        if (file) {
            infoElement.innerHTML = `
                ğŸ“„ ${file.name}<br>
                ğŸ“Š ${(file.size / 1024 / 1024).toFixed(2)} MB
            `;
            infoElement.style.display = 'block';
        } else {
            infoElement.style.display = 'none';
        }
    }
    
    // ===============================
    // ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ù…Ø®Ø·Ø·
    // ===============================
    
    async function saveDrawing() {
        // Ø¥Ø¸Ù‡Ø§Ø± Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„
        const submitButton = document.querySelector('#drawingsForm button[type="submit"]');
        const originalText = submitButton.innerHTML;
        submitButton.innerHTML = 'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...';
        submitButton.disabled = true;
        
        try {
            const data = {
                drawingNumber: document.getElementById("drawingNumber").value,
                buildingModel: document.getElementById("buildingModel").value,
                name: document.getElementById("drawingName").value,
                type: document.getElementById("drawingType").value,
                itemName: document.getElementById("drawingFolder").value,
                statement: document.getElementById("drawingStatement").value,
                lastModified: new Date().toISOString(),
                projectId: projectId,
                companyId: companyId
            };
            
            let message, endpoint, method;
            
            if (currentEditingId) {
                endpoint = `/drawings/${currentEditingId}`;
                method = "PUT";
                message = "âœ… ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø®Ø·Ø· Ø¨Ù†Ø¬Ø§Ø­!";
            } else {
                endpoint = "/drawings";
                method = "POST";
                message = "âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø®Ø·Ø· Ø¨Ù†Ø¬Ø§Ø­!";
            }
            
            // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø®Ø·Ø·
            const response = await apiCall(endpoint, method, data);
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø©
            await loadDrawings();
            renderFolders();
            closeDrawingsModal();
            alert(message);
            
        } catch (error) {
            console.error("Error saving drawing:", error);
            alert(currentEditingId ? "âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø®Ø·Ø·" : "âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø®Ø·Ø·");
        } finally {
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø²Ø±
            submitButton.innerHTML = originalText;
            submitButton.disabled = false;
        }
    }
    
    // ===============================
    // ğŸš€ Ø§Ù„ØªÙ‡ÙŠØ¦Ø©
    // ===============================
    
    function initDrawingsSystem() {
        console.log("ğŸ¯ ØªÙ‡ÙŠØ¦Ø© Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø·Ø·Ø§Øª...");
        
        setupEventListeners();
        renderFolders();
        loadDrawings();
        
        console.log("âœ… ØªÙ… ØªÙ‡ÙŠØ¦Ø© Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø·Ø·Ø§Øª Ø¨Ù†Ø¬Ø§Ø­");
    }
    
    // ØªØ´ØºÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù… Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initDrawingsSystem);
    } else {
        initDrawingsSystem();
    }
    
})();
</script>